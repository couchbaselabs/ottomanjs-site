<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"global.html":{"id":"global.html","title":"Global","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Global Members &lt;readonly&gt; SearchConsistency :number Defines the degree of consistency required for a particular query. Type: number Properties: Name Type Default Description NONE number 0 No degree consistency required LOCAL number 1 Operations performed by this ottoman instance will be reflected in queries performed by this particular ottoman instance. This type of consistency will be slower than no consistency, but faster than GLOBAL as the index state is tracked internally rather than requested from the server. GLOBAL number 2 Operations performed by any client of the Couchbase Server up to the time of the queries dispatch will be reflected in any index results. This is the slowest of all consistency levels as it requires that the server synchronize its indexes to the current key-value state prior to execution of the query. × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Classes Classes CbStoreAdapter ModelInstance Ottoman StoreAdapter × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Ottoman.js (Node.js ODM for Couchbase)Ottoman is a ODM built for Couchbase and Node.js. It is designed to remove all of the boilerplate necessary to build Node.js apps with Couchbase. Useful LinksSource - http://github.com/couchbaselabs/node-ottoman Documentation - http://ottomanjs.com/ Build Your First Application - /docs/first-app.md Couchbase Node.js Community - http://couchbase.com/communities/nodejs Why Use OttomanAn ODM allows developers to: Work natively with JavaScript Objects. Rapidly prototype and define your data model together with their relationships. Let someone else handle the heavy lifting and tedious tasks. Support many different data-types, including several which come predefined with Ottoman in addition to support for custom data-types. Define your validation logic with the models it applies to. Model your data for embedding objects or references and keep those relationships crisp. Provide support for generic finds. Support for multiple indexing strategies natively and automatically. Control and enforce your data model from within your application. Programmatically define object methods that map to the data model. Getting StartedInstallingOttoman is published to npm, to install it in the project, run: npm install ottomanIntroductionSet up your Ottoman instance with a connection to Couchbase. var ottoman = require('ottoman'); var couchbase = require('couchbase'); var cluster = new couchbase.Cluster('couchbase://127.0.0.1'); ottoman.bucket = cluster.openBucket('default');Let's say we want to track all of the furniture in our store. Let's create a model to represent this furniture. var Furniture = ottoman.model('Furniture', { name: 'string' });How about we create our first furniture item. var couch = new Furniture({name:'Couch'}); console.log(couch.name); // 'Couch'We can also add methods directly to our models. Furniture.prototype.dance = function() { console.log('I am furniture, I do not dance.'); };Our furniture now can take an action! var table = new Furniture({name:'Table'}); table.dance();But we haven't actually saved anything to Couchbase yet. Let's do that: table.save(function(err) { if (err) return console.error(err); table.dance(); });Now that we've saved our table to the database, we need to be able to retrieve it. Let's revise our model to add an index on the name! var Furniture = ottoman.model('Furniture', { name: 'string' }, { index: { findByName: { by: 'name' } } });Now we need to ensure that this index is available on the server for searching: ottoman.ensureIndices(function(err) { if (err) return console.error(err); });And finally we can search for our furniture by name: Furniture.findByName('table', function(err, tables) { if (err) return console.error(err); console.log(tables); })Nice Job!We've now created our first model, gave it some methods, saved it to Couchbase and then retrieved it. What Next?Now that you've successfully built your first models, why not give our full application tutorial a try? Build Your First Application SchemasSchemas define the layout of our stored data objects. They contain a list of properties for the document. This can be any JSON representable data. You can store simple types: ottoman.model('User', { who: 'string', howmany: 'number', when: 'Date' });Ottoman supports a number of standard types: string - A string value. number - A floating point value. integer - An integer number. boolean - A boolean value. Date - A date value. Mixed - Any valid Ottoman type, both models and built-in types. These simple types can have default values specified or default value generators: ottoman.model('User', { title: {type: 'string', default: 'No Title'}, when: {type: 'Date', default: Date.now}, rander: {type: 'number', default: function(){ return Math.random(); }} });We can also have arrays: ottoman.model('User', { name: 'string', roles: ['string'] });And groups: ottoman.model('User', { name: { first: 'string', last: 'string', full: 'string' } });And arrays of groups: ottoman.model('User', { name: 'string', roles: [{ type: 'string', permissions: ['string'] }] });You can also define validator functions for model fields: function PhoneValidator(val) { var phoneno = /^\\(?([0-9]{3})\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/; if (val &amp;&amp; !val.match(phoneno)) { throw new Error('Phone number is invalid.'); } } ottoman.model('User', { name: 'string', phone: { type:'string', validator:PhoneValidator }, });Model ReferencesIn addition to supporting groups of properties, models also support referencing whole other documents. Through these references we are able to store related but not necessarily dependent data. Example reference relationship: var Account = ottoman.model('Account', { email: 'string', name: 'string' }); ottoman.model('User', { username: 'string', account: Account });Accessing the data of a referenced document is as simple as requesting the parent document; referenced documents will be loaded by default. Example of creating a referenced document: var myAccount = new Account({ email: 'burtteh@fakemail.com', name: 'Brett Lawson' }); var myUser = new User({ username: 'brett19', account: myAccount; }); myUser.save(function(err) { if (err) throw err; console.log('Documents Saved!'); });Example of accessing the referenced document: User.find({username: 'brett19'}, function(err, myUser) { if (err) throw err; console.log('My Email:', myUser.account.email); // My Email: burtteh@fakemail.com });IndicesYou can specify numerous indices on a model. There are multiple different kinds of indices, each with it's own benefits and restrictions. To specify indices on a model, pass a second \"options\" object to the model function, with an index key: ottoman.model('User', { email: 'string', name: { first: 'string', last: 'string', full: 'string' } }, { index: { findByEmail: { by: 'email', type: 'refdoc' }, findByFirstName: { by: 'name.first', type: 'view' }, findByLastName: { by: 'name.last', type: 'n1ql' } } });In order for indices to be created on the server, you must call the ensureIndices method. This method will internally generate a list of indexes which will be used and the most optimal configuration for them and build any which are missing on the server. This must be called after all models are defined, and it is a good idea to only call this when needed rather than any time your server is started. var ottoman = require('ottoman'); var models = require('./all_my_models'); ottoman.ensureIndices(function(err) { if (err) { console.log('failed to created necessary indices', err); return; } console.log('ottoman indices are ready for use!'); });Index TypesBelow are some quick notes on the types of indices available, and their pros and cons. For a more in-depth discussion, consider reading Couchbasics: How Functional and Performance Needs Determine Data Access in Couchbase refdocThese indices are the most performant, but the least flexible. They allow only a single document to occupy any particular value and do direct key-value lookups using a referential document to identify a matching document in Couchbase. In short, if you need to look up a document by a single value of a single attribute quickly (e.g. key lookups), this is the way to go. But you cannot combine multiple refdoc indexes to speed up finding something like \"all customers with first name 'John' last name 'Smith'\". viewThese indices are the default and use map-reduce views. This type of index is always available once ensureIndices is called and will work with any Couchbase Server version. Because views use map-reduce, certain types of queries can be faster as the query can be parallelized over all nodes in the cluster, with each node returning only partial results. One of the cons of views is that they are eventually consistent by default, and incur a performance penalty if you want consistency in the result. n1qlThese indices utilize the new SQL-like query language available in Couchbase Server 4.0.0. These indices are more performant than views in many cases and are significantly more flexible, allowing even un-indexed searches. N1QL indexes in Ottoman use Couchbase GSIs. If you need flexibility of query and speed, this is the way to go. QueriesQueries allow you to perform searches among your models. For instance allowing you to query all of the posts published by a particular user. User/Post example: ottoman.model('Post', { user: {ref:'User'}, title: 'string', body: 'string' }); ottoman.model('User', { name: 'string' }, { queries: { myPosts: { of: 'Post', by: 'user' } } });Finding models via N1QL QueriesAll models also expose a find method that can locate model instances by any number of criteria, and that also support pagination. This method is very useful for finding model instances under any arbitrary criteria; however keep in mind that you may wish to put N1QL indexes on fields that would be very often a part of these queries, to improve lookup performance, and prevent Couchbase from having to scan most or all documents in the bucket in order to find the results. As you can see in the example below, you can even optionally specify pagination (limit/skip) and adjust the consistency of the query executed on Couchbase. var filters = { lastName: 'Smith', state: 'VA' }; var options = { limit: 10, skip: 10, consistency: ottoman.Consistency.LOCAL }; Customer.find(filters, options, function(err, items) { if (err) throw err; console.log('Page 2 of Smiths of Virginia: ', JSON.stringify(items)); });LicenseCopyright 2013 Couchbase Inc. Licensed under the Apache License, Version 2.0. See the Apache 2.0 license. × Search results Close "},"CbStoreAdapter.html":{"id":"CbStoreAdapter.html","title":"Class: CbStoreAdapter","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Class: CbStoreAdapter CbStoreAdapter new CbStoreAdapter(bucket) The Couchbase store adapter implements an Ottoman StoreAdapter suitable for using Ottoman with Couchbase Server. Parameters: Name Type Description bucket Methods count(type, modelName, options, callback) Performs a count of the documents matching a particular filter expression and model type. Parameters: Name Type Description type string The type of index to use for the search. Currently unused (always N1QL). modelName string The name of the model to look for. options Object Properties Name Type Description filter Object The filter expression for filtering documents for counting. callback StoreAdapter~SearchCallback createIndex(type, modelName, name, fields, callback) Creates an index of the specified type. This simply records the data for the specified index, the bulk of the creation work is actually done in the ensureIndices method. Parameters: Name Type Description type string The type of index to create. This value is passed through from the type field specified in a schema's index definition. modelName string The name of the model this index belongs to. name string The name of the index to created. fields Array.&lt;string&gt; A list of field names that should be indexed. callback StoreAdapter~CreateIndexCallback ensureIndices(callback) Ensures that all indexes specified by createIndex calls are created and available on the server. Parameters: Name Type Description callback StoreAdapter~EnsureCallback find(type, modelName, options, callback) Performs a generic find by a filter expression. Parameters: Name Type Description type string The type of index to use for the search. Currently unused (always N1QL). modelName string The name of the model to search within. options Object Properties Name Type Description filter Object The filter expression to filter with. limit number The maximum number of results to return. skip number The number of results to skip before returning results. sort string | Array.&lt;string&gt; A field name or list of field names to sort the results by. callback StoreAdapter~SearchCallback get(key, callback) Retrieves a stored document by it's key. Parameters: Name Type Description key string The key of the document to retrieve. callback StoreAdapter~GetCallback isNotFoundError(err) Returns whether a particular error is a document not-found error. Parameters: Name Type Description err Returns: Type boolean remove(key, cas, callback) Removes a document using it's key. Parameters: Name Type Description key The key of the document to remove. cas Object If not-null, an opaque CAS value to verify before the operation succeeds. callback StoreAdapter~RemoveCallback searchIndex(type, modelName, name, options, key, range, start, end, callback) Performs a search against an index. Parameters: Name Type Description type string The type of index that we are searching. modelName string The model that this index is related to. name string The name of the index to search options Object key string The specific key we want to locate in the index. range Object start string The starting key of a key-range to search. end string The ending key of a key-range to search. callback StoreAdapter~SearchCallback store(key, data, cas, callback) Stores a document using it's key for later retrieval. Parameters: Name Type Description key string The key of the document to store. data Object The data to store for the document. cas Object If not-null, an opaque CAS value to verify before the operation succeeds. callback StoreAdapter~StoreCallback × Search results Close "},"ModelInstance.html":{"id":"ModelInstance.html","title":"Class: ModelInstance","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Class: ModelInstance ModelInstance new ModelInstance(data) Constructs a new model instance and for models with a default constructor, applies the data in object passed to the instance. Parameters: Name Type Description data Object Methods &lt;static&gt; applyData(mdlInst, data) Applies the data passed in data to the model instance mdlInst. Parameters: Name Type Description mdlInst ModelInstance data Object &lt;static&gt; count(filter [, options], callback) Performs a count of the objects matching the filter in the data store. Parameters: Name Type Argument Description filter Object options Object &lt;optional&gt; Properties Name Type Description sort string | Array.&lt;string&gt; limit number skip number callback function &lt;static&gt; create(data, callback) Creates a new ModelInstance with the passed data and then immediately attempts to save it to the data store. Parameters: Name Type Description data Object callback function &lt;static&gt; find(filter [, options], callback) Perform a filter based search to locate specific model instances. Parameters: Name Type Argument Description filter Object options Object &lt;optional&gt; Properties Name Type Description sort string | Array.&lt;string&gt; limit number skip number callback function &lt;static&gt; fromData(data) Creates a new instance of this Model from the data passed. Parameters: Name Type Description data Object Returns: ModelInstance &lt;static&gt; getById(id, callback) Retrieves a specific model instance from the data store by ID. Parameters: Name Type Description id string callback function &lt;static&gt; loadAll(items, callback) This is a helper method which allows us to load an array of model instances all at once. Parameters: Name Type Description items Array.&lt;ModelInstance&gt; callback function &lt;static&gt; namePath() Returns the full name of the model, including namespace. Returns: Type string &lt;static&gt; plugin(the, options) Registers a plugin for this model. This function will be called immediately with the model itself as the first argument, and the provided options as the second argument. Parameters: Name Type Description the pluginFn plugin function. options option object to pass to the plugin. Returns: Type ModelInstance &lt;static&gt; post(event, fn) Specify a function to be invoked following a particular event on this ModelInstance. The handler will always be called with two arguments: the model instance, and a callback. Parameters: Name Type Description event \"validate\" | \"save\" | \"load\" | \"remove\" fn function &lt;static&gt; pre(event, handler) Specify a handler to be invoked prior to a particular event for this ModelInstance. The handler will always be called with two arguments: the model instance, and a callback function that the handler should call to continue processing. If a pre handler calls the provided callback with an error, the event will not continue. Parameters: Name Type Description event \"validate\" | \"save\" | \"load\" | \"remove\" handler function &lt;static&gt; ref(id) Creates an unloaded model instance referencing a data store item by id. Parameters: Name Type Description id string Returns: Type ModelInstance &lt;static&gt; refByKey(key) Creates an unloaded model instance referencing a data store item by key. Parameters: Name Type Description key string Returns: Type ModelInstance id() Returns the ID of this model instance. Returns: Type string load( [paths], callback) Loads this object, or sub-objects from this object from the data store. This function can be called while a model instance is already loaded to reload the model instance, or to load specific sub-model-instances. Parameters: Name Type Argument Description paths string &lt;optional&gt; &lt;repeatable&gt; Paths to sub-model-instances to load. callback function loaded() Returns whether this model instance is loaded or not. Returns: Type boolean remove(callback) Removes this model instance from the data store. Parameters: Name Type Description callback function save(callback) Saves this model instance to the data store. Parameters: Name Type Description callback function toCoo() Returns a JSON database-serialized version of this model instance. Returns: Type Object toJSON() Returns a JSON serialized version of this model instance. The JSON serialized version is the same as the Coo, with certain internals changed (references) so they are not exposed outside of the DB. Returns: Type Object × Search results Close "},"Ottoman.html":{"id":"Ottoman.html","title":"Class: Ottoman","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Class: Ottoman Ottoman new Ottoman() The core manager class for the ODM. Methods _applyPlugins(a) Applies global plugins to models as they are created. Parameters: Name Type Description a model new model that has been created. Returns: the ottoman singleton for chaining. ensureIndices(callback) Ensures all currently registered indices have been persisted to the data store and are useable. Parameters: Name Type Description callback function fromCoo(data, type) Decodes a model instance from a data object. Parameters: Name Type Description data Object type string Returns: Type ModelInstance getModel(name, prefixed) Returns a specific model based on the name. Parameters: Name Type Description name string prefixed boolean Returns: Type ModelInstanceCtor isModel(model) Returns whether the passed type is a model instance. Parameters: Name Type Description model * Returns: Type boolean isTypeDef(type) Returns whether the passed type is a typedef object. Parameters: Name Type Description type * Returns: Type boolean model(name, schemaDef, options) Creates and registers a model object. Parameters: Name Type Description name string schemaDef Object options Object Properties Name Type Default Description index Object queries Object id string \"_id\" store StoreAdapter this.store Returns: Type ModelInstanceCtor nsPrefix() Returns the currently specific namespace prefix for this manager. Returns: Type string plugin(pluginFn, options) Registers a global plugin with ottoman. Global plugins will be attached to all models defined after this call. Parameters: Name Type Description pluginFn the plugin, which must be a function. options an options object to pass to the plugin function when it is called. Returns: the ottoman singleton for chaining. toCoo(obj) Encodes a model instance to its JSON representation. Parameters: Name Type Description obj ModelInstance Returns: Type Object type(name, options) Creates a typedef specifying a simple name for a list of field options. Parameters: Name Type Description name string options Object Returns: Type TypeDef typeByName(type) Returns the type data for a specific type by name. This can be a model, a typedef or a core type. Parameters: Name Type Description type string Returns: Type ModelInstance | TypeDef | CoreType validate(mdlInst) Executes the validation logic against a model and throws exceptions for any failures. Parameters: Name Type Description mdlInst ModelInstance × Search results Close "},"StoreAdapter.html":{"id":"StoreAdapter.html","title":"Class: StoreAdapter","body":" Ottoman Classes CbStoreAdapterModelInstanceOttomanStoreAdapter Global SearchConsistency Class: StoreAdapter StoreAdapter new StoreAdapter() A store adapter is the low-level provider of database functionality for Ottoman's internal storage system. Type Definitions CreateIndexCallback(err) This callback is invoked by store adapter createIndex operations. Parameters: Name Type Description err Error Any errors that occured during the processing of the request. EnsureCallback(err) This callback is invoked by store adapter ensure operations. Parameters: Name Type Description err Error Any errors that occured during the processing of the request. GetCallback(err, value, cas) This callback is invoked by store adapter get operations. Parameters: Name Type Description err Error Any errors that occured during the processing of the request. value Object The value of the requested document cas Object An opaque identifier representing the current state of this document. RemoveCallback(err) This callback is invoked by store adapter remove operations. Parameters: Name Type Description err Error Any errors that occured during the processing of the request. SearchCallback(err, results) This callback is invoked by store adapter search operations. Parameters: Name Type Description err Error Any errors that occured during the processing of the request. results Array.&lt;Object&gt; A list of result documents from the search. StoreCallback(err, cas) This callback is invoked by store adapter store operations. Parameters: Name Type Description err Error Any errors that occured during the processing of the request. cas Object An opaque identifier representing the current state of this document. × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
