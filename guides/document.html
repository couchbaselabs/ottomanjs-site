<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documents | Ottoman.js</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Ottoman is a ODM built for Couchbase and Node.js. ">
    
    <link rel="preload" href="/assets/css/0.styles.4985b6e7.css" as="style"><link rel="preload" href="/assets/js/app.7df2c00e.js" as="script"><link rel="preload" href="/assets/js/2.2b957f68.js" as="script"><link rel="preload" href="/assets/js/59.cd69c5b9.js" as="script"><link rel="prefetch" href="/assets/js/10.97f250d3.js"><link rel="prefetch" href="/assets/js/11.f6802f78.js"><link rel="prefetch" href="/assets/js/12.5201d6ec.js"><link rel="prefetch" href="/assets/js/13.ded14b06.js"><link rel="prefetch" href="/assets/js/14.248c7e45.js"><link rel="prefetch" href="/assets/js/15.c2d6e1d1.js"><link rel="prefetch" href="/assets/js/16.e037f9da.js"><link rel="prefetch" href="/assets/js/17.201ed28f.js"><link rel="prefetch" href="/assets/js/18.0c2bd03b.js"><link rel="prefetch" href="/assets/js/19.e0b24795.js"><link rel="prefetch" href="/assets/js/20.aac21881.js"><link rel="prefetch" href="/assets/js/21.a1ff9116.js"><link rel="prefetch" href="/assets/js/22.a85dc4a2.js"><link rel="prefetch" href="/assets/js/23.ae2a9425.js"><link rel="prefetch" href="/assets/js/24.64f5c82f.js"><link rel="prefetch" href="/assets/js/25.4967f29b.js"><link rel="prefetch" href="/assets/js/26.b8046ede.js"><link rel="prefetch" href="/assets/js/27.91544445.js"><link rel="prefetch" href="/assets/js/28.0597916e.js"><link rel="prefetch" href="/assets/js/29.9071660b.js"><link rel="prefetch" href="/assets/js/3.bd53055d.js"><link rel="prefetch" href="/assets/js/30.f87a51c1.js"><link rel="prefetch" href="/assets/js/31.ca0c54ee.js"><link rel="prefetch" href="/assets/js/32.e58e5aa8.js"><link rel="prefetch" href="/assets/js/33.ba887139.js"><link rel="prefetch" href="/assets/js/34.82a80168.js"><link rel="prefetch" href="/assets/js/35.a1dd7856.js"><link rel="prefetch" href="/assets/js/36.a7f7f170.js"><link rel="prefetch" href="/assets/js/37.41058396.js"><link rel="prefetch" href="/assets/js/38.03fd1ffc.js"><link rel="prefetch" href="/assets/js/39.27a7f983.js"><link rel="prefetch" href="/assets/js/4.e8b04f10.js"><link rel="prefetch" href="/assets/js/40.5eebacdb.js"><link rel="prefetch" href="/assets/js/41.bfa58509.js"><link rel="prefetch" href="/assets/js/42.52a95906.js"><link rel="prefetch" href="/assets/js/43.599719af.js"><link rel="prefetch" href="/assets/js/44.f10b4740.js"><link rel="prefetch" href="/assets/js/45.85e2ff10.js"><link rel="prefetch" href="/assets/js/46.cacc8613.js"><link rel="prefetch" href="/assets/js/47.ca1c42c6.js"><link rel="prefetch" href="/assets/js/48.d829ca40.js"><link rel="prefetch" href="/assets/js/49.3e44e380.js"><link rel="prefetch" href="/assets/js/5.909109eb.js"><link rel="prefetch" href="/assets/js/50.4f77aae7.js"><link rel="prefetch" href="/assets/js/51.a98d0bcc.js"><link rel="prefetch" href="/assets/js/52.bdbee8df.js"><link rel="prefetch" href="/assets/js/53.21270f8a.js"><link rel="prefetch" href="/assets/js/54.91d3cbfe.js"><link rel="prefetch" href="/assets/js/55.95513bab.js"><link rel="prefetch" href="/assets/js/56.b9f71acf.js"><link rel="prefetch" href="/assets/js/57.0a3cbb48.js"><link rel="prefetch" href="/assets/js/58.b57dbb69.js"><link rel="prefetch" href="/assets/js/6.7f7d981d.js"><link rel="prefetch" href="/assets/js/60.47714036.js"><link rel="prefetch" href="/assets/js/61.76e5a7e1.js"><link rel="prefetch" href="/assets/js/62.30294ff8.js"><link rel="prefetch" href="/assets/js/63.c9542409.js"><link rel="prefetch" href="/assets/js/64.4089247a.js"><link rel="prefetch" href="/assets/js/65.1585ee5f.js"><link rel="prefetch" href="/assets/js/66.46093420.js"><link rel="prefetch" href="/assets/js/67.5a1971a2.js"><link rel="prefetch" href="/assets/js/68.7419f79f.js"><link rel="prefetch" href="/assets/js/69.56cf432a.js"><link rel="prefetch" href="/assets/js/7.3b8b1c77.js"><link rel="prefetch" href="/assets/js/70.db175dd3.js"><link rel="prefetch" href="/assets/js/71.d944a4f0.js"><link rel="prefetch" href="/assets/js/72.2635c124.js"><link rel="prefetch" href="/assets/js/73.82fd77d4.js"><link rel="prefetch" href="/assets/js/74.81c43d4f.js"><link rel="prefetch" href="/assets/js/75.48f31ad7.js"><link rel="prefetch" href="/assets/js/76.e07fcbb3.js"><link rel="prefetch" href="/assets/js/77.72d3b3a7.js"><link rel="prefetch" href="/assets/js/78.1ad971f9.js"><link rel="prefetch" href="/assets/js/79.f00b95bb.js"><link rel="prefetch" href="/assets/js/8.5fc3795d.js"><link rel="prefetch" href="/assets/js/80.ad809365.js"><link rel="prefetch" href="/assets/js/81.0b9b0af2.js"><link rel="prefetch" href="/assets/js/82.78a6d642.js"><link rel="prefetch" href="/assets/js/83.d36253e1.js"><link rel="prefetch" href="/assets/js/84.56920f78.js"><link rel="prefetch" href="/assets/js/85.3dd9b122.js"><link rel="prefetch" href="/assets/js/86.e7d235ee.js"><link rel="prefetch" href="/assets/js/87.58a4e5ce.js"><link rel="prefetch" href="/assets/js/88.e11d6622.js"><link rel="prefetch" href="/assets/js/89.16509fe6.js"><link rel="prefetch" href="/assets/js/9.fe952048.js"><link rel="prefetch" href="/assets/js/90.cbe7453f.js"><link rel="prefetch" href="/assets/js/91.d673f61a.js"><link rel="prefetch" href="/assets/js/92.b9bf4043.js"><link rel="prefetch" href="/assets/js/93.2bb2ccbd.js"><link rel="prefetch" href="/assets/js/94.963249f4.js"><link rel="prefetch" href="/assets/js/95.aec514d4.js"><link rel="prefetch" href="/assets/js/96.c360789c.js"><link rel="prefetch" href="/assets/js/97.9b7a6f93.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4985b6e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ottoman.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" class="nav-link">
  How Ottoman works
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" class="nav-link">
  How Ottoman works
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Documents</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guides/document.html#documents-vs-models" class="sidebar-link">Documents vs Models</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/document.html#retrieving" class="sidebar-link">Retrieving</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/document.html#updating" class="sidebar-link">Updating</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/document.html#validating" class="sidebar-link">Validating</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/document.html#populate" class="sidebar-link">Populate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/document.html#saving-refs" class="sidebar-link">Saving refs</a></li><li class="sidebar-sub-header"><a href="/guides/document.html#using-population" class="sidebar-link">Using Population</a></li><li class="sidebar-sub-header"><a href="/guides/document.html#checking-whether-a-field-is-populated" class="sidebar-link">Checking Whether a Field is Populated</a></li><li class="sidebar-sub-header"><a href="/guides/document.html#advanced-population" class="sidebar-link">Advanced Population</a></li></ul></li><li><a href="/guides/document.html#next-up" class="sidebar-link">Next Up</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="documents"><a href="#documents" class="header-anchor">#</a> Documents</h1> <p>Ottoman documents represent a one-to-one mapping to documents as stored in Couchbase Server. Each document is an instance of its Model.</p> <h2 id="documents-vs-models"><a href="#documents-vs-models" class="header-anchor">#</a> Documents vs Models</h2> <p>Document and <a href="/guides/model">Model</a> are distinct classes in Ottoman. The Model class is a subclass of the Document class.
When you use the Model constructor, you create a new document.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> MyModel <span class="token operator">=</span> ottoman<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

doc <span class="token keyword">instanceof</span> <span class="token class-name">MyModel</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
doc <span class="token keyword">instanceof</span> <span class="token class-name">ottoman<span class="token punctuation">.</span>Model</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
doc <span class="token keyword">instanceof</span> <span class="token class-name">ottoman<span class="token punctuation">.</span>Document</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>In Ottoman, a <code>document</code> generally means an instance of a model. You should not have to create an instance of the Document class without going through a model.</p> <h2 id="retrieving"><a href="#retrieving" class="header-anchor">#</a> Retrieving</h2> <p>When you load documents from Couchbase Server using model functions like findById(), you get a Ottoman <code>document</code> back.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token keyword">await</span> MyModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

doc <span class="token keyword">instanceof</span> <span class="token class-name">MyModel</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
doc <span class="token keyword">instanceof</span> <span class="token class-name">ottoman<span class="token punctuation">.</span>Model</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
doc <span class="token keyword">instanceof</span> <span class="token class-name">ottoman<span class="token punctuation">.</span>Document</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="updating"><a href="#updating" class="header-anchor">#</a> Updating</h2> <p>Ottoman documents track changes. You can modify a document using vanilla JavaScript assignments and Ottoman will convert it into Couchbase update operators.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>

<span class="token comment">// Ottoman sends an `updateById(doc.id, { name: 'foo' })`</span>
<span class="token comment">// to Couchbase Server.</span>
<span class="token keyword">await</span> doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the document with the corresponding id is not found, Ottoman will report a <code>DocumentNotFoundError</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token keyword">await</span> MyModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete the document so Ottoman won't be able to save changes</span>
<span class="token keyword">await</span> MyModel<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Throws DocumentNotFoundError</span>
</code></pre></div><p>The <code>save()</code> function is generally the right way to update a document with Ottoman. With <code>save()</code>, you get full validation and middleware.</p> <h2 id="validating"><a href="#validating" class="header-anchor">#</a> Validating</h2> <p>Documents are casted and validated before they are saved.
Ottoman first casts values to the specified type and then validates them. Internally,
Ottoman calls the document's validate() method before saving.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Number<span class="token punctuation">,</span> min<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Person <span class="token operator">=</span> ottoman<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Cast to Number failed for value &quot;bar&quot; at path &quot;age&quot;</span>
<span class="token keyword">await</span> p<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Path `age` (-1) is less than minimum allowed value (0).</span>
<span class="token keyword">await</span> p2<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="populate"><a href="#populate" class="header-anchor">#</a> Populate</h2> <p>Population is the process of automatically replacing the specified paths in the document with document(s) from other collection(s).
We may populate a single document, multiple documents, a plain object, multiple plain objects, or all objects returned from a query.
Let's look at some examples.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Schema<span class="token punctuation">,</span> model<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> personSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> String<span class="token punctuation">,</span>
  age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
  stories<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'Story'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> storySchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  author<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'Person'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> String<span class="token punctuation">,</span>
  fans<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'Person'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Story <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Story'</span><span class="token punctuation">,</span> storySchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Person <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> personSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So far we've created two Models. Our Person model has its stories field set to an array of ids.
The ref option is what tells Ottoman which model to use during population, in our case the Story model.
All ids we store here must be document ids from the Story model.</p> <h3 id="saving-refs"><a href="#saving-refs" class="header-anchor">#</a> Saving refs</h3> <p>Saving refs to other documents works the same way you normally save properties, just assign the <code>id</code> value:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> author <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Ian Fleming'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">50</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> author<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> story1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Story</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">'Casino Royale'</span><span class="token punctuation">,</span>
  author<span class="token operator">:</span> author<span class="token punctuation">.</span>id    <span class="token comment">// assign the id from the person</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> story1<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="using-population"><a href="#using-population" class="header-anchor">#</a> Using Population</h3> <p>So far we haven't done anything much different. We've merely created a Person and a Story.
Now let's take a look at populating our story's author:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Populate using document</span>
<span class="token keyword">const</span> story <span class="token operator">=</span> <span class="token keyword">await</span> Story<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">'storyId'</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> story<span class="token punctuation">.</span><span class="token function">_populate</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The author is %s'</span><span class="token punctuation">,</span> story<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints &quot;The author is Ian Fleming&quot;</span>


<span class="token comment">// Populate using Model</span>
<span class="token keyword">const</span> stories <span class="token operator">=</span> <span class="token keyword">await</span> Story<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'Casino Royale'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>populate<span class="token operator">:</span> <span class="token string">'author'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> story <span class="token operator">=</span> stories<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The author is %s'</span><span class="token punctuation">,</span> story<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// prints &quot;The author is Ian Fleming&quot;</span>
</code></pre></div><p>Populated paths are no longer set to their original id, their value is replaced with the Ottoman document returned from the database by performing a separate query before returning the results.</p> <p>Arrays of refs work the same way. Just call the populate method on the query and an array of documents will be returned in place of the original ids.</p> <h3 id="checking-whether-a-field-is-populated"><a href="#checking-whether-a-field-is-populated" class="header-anchor">#</a> Checking Whether a Field is Populated</h3> <p>You can call the <code>_populated()</code> function to check whether a field is populated. If <code>_populated()</code> returns a truthy value, you can assume the field is populated.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>story<span class="token punctuation">.</span><span class="token function">_populated</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// truthy</span>

story<span class="token punctuation">.</span><span class="token function">_depopulate</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Make `author` not populated anymore</span>
story<span class="token punctuation">.</span><span class="token function">_populated</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><p>A common reason for checking whether a path is populated is getting the author id.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>story<span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// truthy</span>
story<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">;</span> 

story<span class="token punctuation">.</span><span class="token function">depopulate</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Make `author` not populated anymore</span>
story<span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><h3 id="advanced-population"><a href="#advanced-population" class="header-anchor">#</a> Advanced Population</h3> <p>You can use the <code>*</code> symbol as a wildcard to populate all references in the current model, in this example all properties types references will be populated:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> story<span class="token punctuation">.</span><span class="token function">_populate</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Also, you can setup to automatically populate child document references, by passing a second integer value to <code>_populate</code> function,
this value will tell to Ottoman how deep you want to populate.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Using on a document</span>
<span class="token keyword">await</span> story<span class="token punctuation">.</span><span class="token function">_populate</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Using on a Model</span>
<span class="token keyword">const</span> stories <span class="token operator">=</span> <span class="token keyword">await</span> Story<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'Casino Royale'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>populate<span class="token operator">:</span> <span class="token string">'author'</span><span class="token punctuation">,</span> populateMaxDeep<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>In the above example Ottoman will populate all references on story and story children.
It doesn't matter if they are single or array references.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Beware from setting a large integer value on populate <code>deep</code> argument, it could affect the query performance.</p></div> <h2 id="next-up"><a href="#next-up" class="header-anchor">#</a> Next Up</h2> <p>Now that we've covered Documents, let's take a look at <a href="/guides/query-builder">Query Builder</a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7df2c00e.js" defer></script><script src="/assets/js/2.2b957f68.js" defer></script><script src="/assets/js/59.cd69c5b9.js" defer></script>
  </body>
</html>
